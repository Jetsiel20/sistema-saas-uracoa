{% extends "base.html" %}

{% block title %}Tablero de Triage{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="bi bi-clipboard2-pulse"></i> Tablero de Triage</h2>
        <div>
            <span class="badge bg-danger fs-5 me-2">1: {{ emergencias|selectattr('nivel_triage', 'equalto', 1)|list|length }}</span>
            <span class="badge bg-warning fs-5 me-2">2-3: {{ (emergencias|selectattr('nivel_triage', 'equalto', 2)|list|length + emergencias|selectattr('nivel_triage', 'equalto', 3)|list|length) }}</span>
            <span class="badge bg-success fs-5">4-5: {{ (emergencias|selectattr('nivel_triage', 'equalto', 4)|list|length + emergencias|selectattr('nivel_triage', 'equalto', 5)|list|length) }}</span>
        </div>
    </div>

    {% if emergencias %}
    <div class="row">
        {% for emerg in emergencias %}
        <div class="col-md-6 col-lg-4 mb-3">
            <div class="card border-{{ emerg.color_triage_badge }}">
                <div class="card-header bg-{{ emerg.color_triage_badge }} text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="fs-4"><strong>{{ emerg.codigo_emergencia }}</strong></span>
                        <span class="badge bg-light text-dark fs-3">{{ emerg.nivel_triage }}</span>
                    </div>
                </div>
                <div class="card-body">
                    <h5>{{ emerg.paciente.nombre_completo }}</h5>
                    <p class="mb-1"><strong>Tipo:</strong> {{ emerg.tipo_emergencia.title() }}</p>
                    <p class="mb-1"><strong>Ingreso:</strong> {{ emerg.fecha_ingreso.strftime('%H:%M') }}</p>
                    <p class="mb-1"><strong>Tiempo:</strong> {{ emerg.tiempo_atencion }}h</p>
                    <p class="mb-2"><strong>Motivo:</strong> {{ emerg.motivo_consulta[:80] }}...</p>
                    <a href="{{ url_for('emergencias.show', id=emerg.id) }}" class="btn btn-sm btn-outline-primary w-100">
                        Ver detalle
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="alert alert-info text-center">
        <h4>No hay emergencias activas</h4>
        <p>Todas las emergencias han sido atendidas</p>
    </div>
    {% endif %}
</div>
{% endblock %}
